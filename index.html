<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BeforeSatoshi Live Bubble Map Organic</title>
<style>
body { margin:0; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; background:#0a0a0f; font-family:sans-serif; color:#fff; }
header { text-align:center; margin:8px 0; }
header h2 { font-size:14px; margin:0; color:#fff; font-weight:400; }
header h1 { font-size:24px; margin:0; }
header h1 .before { color:#fff; }
header h1 .satoshi { color:#ff8c00; }
#buttons { margin-bottom:8px; }
button { margin:0 4px; padding:4px 10px; border:none; border-radius:4px; background:#222; color:#fff; cursor:pointer; }
button.active { background:#ff8c00; color:#000; }
#container { width:80vmin; height:80vmin; background:#111; border:2px solid #ff8c00; border-radius:12px; position:relative; overflow:hidden; box-shadow:0 0 25px #ff8c00; user-select:none; }
svg { width:100%; height:100%; }
text { font-weight:700; pointer-events:none; font-size:12px; text-anchor:middle; fill:#fff; text-shadow: 1px 1px 2px #000; }
#popup { position:absolute; top:-200px; left:50%; transform:translateX(-50%); background:#222; border:2px solid #ff8c00; border-radius:10px; padding:10px 15px; color:#fff; opacity:0; transition:0.3s; z-index:10; }
#popup .close { cursor:pointer; float:right; margin-left:10px; }
#fund { margin-top:8px; font-size:12px; }
#fund span.wallet { color:#fff; }
#fund span.label { color:orange; font-weight:700; margin-right:4px; }
</style>
</head>
<body>

<header>
  <h2>Powered By</h2>
  <h1><span class="before">Before</span> <span class="satoshi">Satoshi</span></h1>
</header>

<div id="buttons">
  <button data-period="1">1h</button>
  <button data-period="6">6h</button>
  <button data-period="24" class="active">24h</button>
</div>

<div id="container">
  <svg id="svg"></svg>
  <div id="popup"></div>
</div>
<div id="fund"><span class="label">FUND US:</span> <span class="wallet">HFs2KJxfp6jraXc69v2ouuDNTVfTm8er78UYQqqWuQP5</span></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
(async function(){
const container = document.getElementById("container");
const width = container.clientWidth;
const height = container.clientHeight;
const svg = d3.select("#svg");
const popup = document.getElementById("popup");

// Adjustable parameters
const minRadius = 25;
const maxRadius = 65;
const collisionPadding = 2;
const motionStrength = 0.00006;
const easing = 0.05;
const initialSpeed = 0.12;

const tokensData = [
  {pairId:"GNEqyxGV9u8Hz5G3RX1VxUfWCQFuXEP2ckmbLxe1bmyf", logo:"https://i.postimg.cc/FH603Pk6/20250813-191724.jpg"},
  {pairId:"4MzZA4pqd7HqU9gQKuLSwtC5nUxFpmw5PvRmGoSGMNx", logo:"https://via.placeholder.com/128/ff0000/000000?text=2"},
  {pairId:"3kZxw7r663dNYqbw8zGCK7NRrcBMXMcRnv3heak4F7mC", logo:"https://i.postimg.cc/bYLD16KR/0-EJccfm2-400x400.jpg"},
  {pairId:"ENYbntd3KgJJJvMqbe5Awtqu8jkVjnczU8TK46q3odnG", logo:"https://i.postimg.cc/7PBh552s/Gy-Ud-RTy-W4-AM-G6-C.jpg"},
  {pairId:"8eQTQLnBmEgeY9avVjrqqgX8ZVr8MRFrXEHpMrx6DGff", logo:"https://i.postimg.cc/zXBL7CNY/H_NjEv35_400x400.jpg"},
  {pairId:"3BfzLnxHVaYJNrAP6SxfT7Z8nFe5ybKL6JMTuCrNR8zZ", logo:"https://i.postimg.cc/tJ1jZCKw/frame-00-delay-0-07s.gif"},
  {pairId:"C53QBLiDTYhQEgsHKQDS4kEAwEKty1nDkYxF6w67dvBh", logo:"https://i.postimg.cc/q7Qn6rVR/Orynth1.png"},
  {pairId:"8Lvqv2jgNvcx1NDtMHd5Ahx8ZUjETfLwygq9MtDfPHxe", logo:"https://i.postimg.cc/3xjHDqq8/FHCTY98-B-400x400.jpg"},
  {pairId:"3HP2Gg5sTaNta2ztzrRCA63btYSeyptASkGLcyQXWfBU", logo:"https://i.postimg.cc/T2mG6hc5/Gx85g-A2b-QAA3ea9.jpg"},
  {pairId:"DDizsNbsgwgX3icRb6JQ8vFrRa5cN5Nuj6u63dRAoDQv", logo:"https://i.postimg.cc/sgv2YFmV/frame_00_delay-0.07s.png"}
];

async function fetchPair(pair){
  try {
    const res = await fetch(`https://api.dexscreener.com/latest/dex/pairs/solana/${pair.pairId}`);
    const p = (await res.json()).pairs?.[0];
    if(!p?.baseToken?.symbol) return null;
    return {
      ticker: p.baseToken.symbol,
      price: Number(p.priceUsd),
      mcap: Number(p.liquidity?.usd) || 0,
      change24: Number(p.priceChange?.h24) || 0,
      change6: Number(p.priceChange?.h6) || 0,
      change1: Number(p.priceChange?.h1) || 0,
      logo: pair.logo
    };
  } catch(e){ console.warn("Error", pair.pairId); return null; }
}

let tokens = (await Promise.allSettled(tokensData.map(fetchPair)))
  .filter(r=>r.status==="fulfilled" && r.value)
  .map(r=>r.value);

let currentPeriod = "24";

function computeRadius(period){
  const scale = d3.scaleSqrt()
    .domain([0,d3.max(tokens,d=>Math.abs(d["change"+period]))])
    .range([minRadius,maxRadius]);
  tokens.forEach(d=> d.r = scale(Math.abs(d["change"+period])));
}

computeRadius(currentPeriod);

// INITIAL POSITIONS TO FILL BOUNDARIES
tokens.forEach(d=>{
  // Spread positions from edge to edge
  d.x = Math.random()*(width - 2*d.r) + d.r;
  d.y = Math.random()*(height - 2*d.r) + d.r;
  d.vx = (Math.random()-0.5)*initialSpeed;
  d.vy = (Math.random()-0.5)*initialSpeed;
});

const node = svg.selectAll("g").data(tokens).enter().append("g")
  .attr("transform", d=>`translate(${d.x},${d.y})`)
  .style("cursor","pointer");

const circles = node.append("circle")
  .attr("r", d=>d.r)
  .attr("fill","none")
  .attr("stroke", d=>d["change"+currentPeriod]>=0?"#16ff00":"#ff3d3d")
  .attr("stroke-width",3)
  .style("filter", d=>d["change"+currentPeriod]>=0?"drop-shadow(0 0 15px #16ff00)":"drop-shadow(0 0 15px #ff3d3d)");

// HOVER - individual bubble
node.on("mouseover", function(event,d){ 
    d3.select(this).select("circle")
      .attr("stroke","#fff")
      .style("filter","drop-shadow(0 0 35px #fff)"); 
})
.on("mouseout", function(event,d){ 
    d3.select(this).select("circle")
      .attr("stroke", d["change"+currentPeriod]>=0?"#16ff00":"#ff3d3d")
      .style("filter", d["change"+currentPeriod]>=0?"drop-shadow(0 0 15px #16ff00)":"drop-shadow(0 0 15px #ff3d3d"); 
});

// CLIP LOGO
node.append("clipPath").attr("id",(d,i)=>`clip-${i}`)
  .append("circle").attr("r",d=>d.r*0.85).attr("cx",0).attr("cy",0);

node.append("image")
  .attr("xlink:href", d=>d.logo)
  .attr("x", d=>-d.r*0.85)
  .attr("y", d=>-d.r*0.85)
  .attr("width", d=>2*d.r*0.85)
  .attr("height", d=>2*d.r*0.85)
  .attr("clip-path",(d,i)=>`url(#clip-${i})`);

node.append("text").attr("dy",-4).text(d=>d.ticker)
  .style("text-shadow","1px 1px 2px #000");
node.append("text").attr("dy",16)
  .text(d=> (d["change"+currentPeriod]>0?"+":"") + d["change"+currentPeriod].toFixed(1)+"%")
  .style("text-shadow","1px 1px 2px #000");

// CLICK popup
node.on("click",(event,d)=>{
  const change = d["change"+currentPeriod];
  popup.innerHTML = `<span class="close">âœ•</span>
    <b>${d.ticker}</b><br>
    Price: $${d.price.toFixed(4)}<br>
    MCAP: $${(d.mcap/1e6).toFixed(2)}M<br>
    Change${currentPeriod}h: <span style="color:${change>=0?'#16ff00':'#ff3d3d'}">${(change>0?"+":"")+change.toFixed(2)}%</span>`;
  popup.style.top = "20px"; popup.style.opacity="1";
  popup.querySelector(".close").addEventListener("click",()=>{popup.style.opacity="0"; popup.style.top="-200px";});
  event.stopPropagation();
});

document.addEventListener("click",()=>{ popup.style.opacity="0"; popup.style.top="-200px"; });

let mouse = {x:width/2, y:height/2};
svg.on("mousemove",(event)=>{ const [mx,my] = d3.pointer(event); mouse.x=mx; mouse.y=my; });

function animate(){
  tokens.forEach(d=>{
    d.vx += (mouse.x-d.x)*motionStrength;
    d.vy += (mouse.y-d.y)*motionStrength;
    d.x += d.vx * easing;
    d.y += d.vy * easing;
    d.x = Math.max(d.r, Math.min(width-d.r,d.x));
    d.y = Math.max(d.r, Math.min(height-d.r,d.y));
  });

  // COLLISION
  for(let i=0;i<tokens.length;i++){
    for(let j=i+1;j<tokens.length;j++){
      const a=tokens[i], b=tokens[j];
      const dx=b.x-a.x, dy=b.y-a.y, dist=Math.sqrt(dx*dx+dy*dy);
      const minDist = a.r + b.r + collisionPadding;
      if(dist<minDist){
        const angle=Math.atan2(dy,dx);
        const overlap = (minDist - dist)/2;
        const ox = Math.cos(angle)*overlap;
        const oy = Math.sin(angle)*overlap;
        a.x -= ox; a.y -= oy;
        b.x += ox; b.y += oy;
      }
    }
  }

  node.attr("transform",d=>`translate(${d.x},${d.y})`);
  requestAnimationFrame(animate);
}

animate();

// PERIOD BUTTONS
document.querySelectorAll("#buttons button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    currentPeriod=btn.dataset.period;
    document.querySelectorAll("#buttons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    computeRadius(currentPeriod);
    node.select("circle").attr("r",d=>d.r)
      .attr("stroke", d=>d["change"+currentPeriod]>=0?"#16ff00":"#ff3d3d");
    node.select("clipPath circle").attr("r",d=>d.r*0.85);
    node.select("image").attr("x",d=>-d.r*0.85).attr("y",d=>-d.r*0.85).attr("width",d=>2*d.r*0.85).attr("height",d=>2*d.r*0.85);
    node.selectAll("text").filter((d,i)=>i%2===1)
      .text(d=> (d["change"+currentPeriod]>0?"+":"") + d["change"+currentPeriod].toFixed(1) + "%");
  });
});
})();
</script>
</body>
</html>
